<template>
    <div>
        <div class="col-xs col col-sm col-md col-lg col-xl-12  body-main-inside delete-padding" style="margin-top: 90px;">
            <div class="col-xs col col-sm col-md col-lg col-xl-11 all-page-inside flex d-p-responsive">
                <div class="col-xs col col-sm col-md col-lg col-xl-12 contact-us-inside">
                    <div class="col-xs col col-sm col-md col-lg col-xl-12 send-file-top flex">
                        <div class="col-xs col col-sm col-md col-lg col-xl-6 send-file-top-right">
                            <div class="col-xs col col-sm col-md col-lg col-xl-12 contact-us-inside-right-top flex delete-padding">

                                <div class="col-xs col col-sm col-md col-lg col-xl-2 filter-all-right-top-icon delete-padding">
                                    <div class="calculate-price delete-padding m-icon">
                                        <img src="/img/icon/send-file.png">
                                    </div>
                                </div>
                                <div class="col-xs col col-sm col-md col-lg col-xl-10 filter-all-right-top-price delete-padding">
                                    <div class="m-price">
                                        <span class=" text-white title-3"> ارسال فایل</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs col col-sm col-md col-lg col-xl-12 send-file-bottom flex">
                        <div class="col-xs col col-sm col-md col-lg-8 col-xl-9 send-file-bottom-right">
                            <div class="col-xs col col-sm col-md col-lg col-xl-12 contact-us-inside2 flex">


                                <div class="col-xs col col-sm col-md col-lg col-xl-6 important-points-inside-right">
                                    <div class="col-xs col col-sm col-md col-lg col-xl-12 contact-us-inside-right-top flex delete-padding">

                                        <div class="col-xs col col-sm col-md col-lg col-xl-2 filter-all-right-top-icon delete-padding">
                                            <div class="calculate-price delete-padding m-icon">
                                                <img src="/img/icon/important.png">

                                            </div>
                                        </div>
                                        <div class="col-xs col col-sm col-md col-lg col-xl-10 filter-all-right-top-price delete-padding">
                                            <div class="m-price">
                                                <span class=" text-white title-3">  نکات مهم چاپ</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-right-top">
                                        <ul>
                                            <li>
                                                <span class="number-color" style="padding-right: 3px;">1.<span class="title-5 text-black">  فایل  متن با فرمت pdf  و فایل جلد با فرمت zip یا jpg باشد . </span></span>
                                            </li>
                                            <li>
                                                <span class="number-color">2.<span class="title-5 text-black"> در طراحی جلد و متن با توجه به قطع کتاب از سه طرف به اندازه حداقل ./5 سانتی متر حاشیه برش رعایت شود. </span></span>
                                            </li>
                                            <li>
                                                <span class="number-color">3.<span class="title-5 text-black"> کیفیت تمام فایل های ارسالی باید 300dpi باشد . </span></span>
                                            </li>
                                            <li>
                                                <span class="number-color">4.<span class="title-5 text-black">  در صورت استفاده از تصاویر بی کیفیت , سفارش شما با همان کیفیت چاپ خواهد شد . </span></span>
                                            </li>
                                            <li>
                                                <span class="number-color">5.<span class="title-5 text-black">  در طراحی جلد ,اندازه عطف کتاب باید متناسب با تعداد صفحات بوده و چنانچه نیاز به محاسبه و اطلاع از اندازه عطف جلد کتاب خود (نسبت به تعداد صفحات و گرماژ کاغد ) دارید اینجا کیلیک  نمایید . </span></span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-right-bottom" style="margin-top:20px;">

                                        <!--<div class="important-points-inside-right-bottom-Computing">
                                            <a href="/Calculate-turning-size" target="_blank"><span class="title-4" style="margin-right: 60px;"> محاسبه اندازه عطف  </span></a>
                                        </div>-->
                                        <div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-right-bottom-advice" style="height:36px;">
                                            <div class="col-xs col col-sm col-md-6 col-lg-6 col-xl-4 important-points-img delete-padding-left">
                                                <img src="/img/icon/book.png" style="    width: 36px;
    height: 35px;
    vertical-align: sub;">
                                            </div>
                                            <div class="col-xs col col-sm col-md-6 col-lg-5 col-xl-8 important-points-span delete-padding-right">
                                                <a href="/Calculate-turning-size"><span class="title-4">  محاسبه اندازه عطف </span></a>
                                            </div>
                                        </div>
                                        <!--<div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-right-bottom-advice" style="height:36px !important;">
                                            <div class="col-xs col col-sm col-md-6 col-lg-6 col-xl-4 important-points-img delete-padding-left">
                                                <img src="/img/icon/contact2.png">
                                            </div>
                                            <div class="col-xs col col-sm col-md-6 col-lg-5 col-xl-8 important-points-span delete-padding-right">
                                                <a href="#"><span class="title-4">   مشاوره قبل از چاپ </span></a>
                                            </div>
                                        </div>-->

                                        </div>
                                    </div>


                                <div class="col-xs col col-sm col-md col-lg col-xl-6 important-points-inside-left">
                                    <div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-left-top">
                                        <div class="important-points-inside-left-top-inside flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-white title-5" style="padding-right: 10px;"> قطع </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-white title-5">   اندازه کاغذ </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-white title-5">  پس از برش </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs col col-sm col-md col-lg col-xl-12 important-points-inside-left-bottom">
                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 "> رحلی </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 21 * 29/7 : A4  </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5">  20/5 * 28/7 </span>
                                            </div>
                                        </div>
                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 "> وزیری </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 17/5 * 25 : B5 </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5">  17 * 24 </span>
                                            </div>
                                        </div>
                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 "> رقعی بزرگ </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 15 * 22/5 :A5+ </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5"> 14/5 * 21/5 </span>
                                            </div>
                                        </div>

                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 " style="margin-left: -6px;">رقعی کوچک</span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5">   15 * 21 : A5   </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5">  14/5 * 20 </span>
                                            </div>
                                        </div>
                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-md-3 Cut">
                                                <span class="text-purple-input title-5 " style="margin-left: -6px;"> خشتی بزرگ  </span>
                                            </div>
                                            <div class="col-md-5 Paper-size">
                                                <span class="text-black title-5"> 20 * 20 </span>
                                            </div>
                                            <div class="col-md-4 After-cutting">
                                                <span class="text-black title-5">  19/5 * 19 </span>
                                            </div>
                                        </div>

                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 " style="margin-left: -13px;"> خشتی کوچک </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 15 * 15 </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5"> 14/5 * 14 </span>
                                            </div>
                                        </div>
                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 ">  پالتویی </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 11/5 * 21/5 </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5">  11 * 19/5 </span>
                                            </div>
                                        </div>

                                        <div class="important-points-inside-left-top-inside2 flex">
                                            <div class="col-xs col col-sm col-md col-lg col-xl-3 Cut">
                                                <span class="text-purple-input title-5 "> جیبی </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-5 Paper-size">
                                                <span class="text-black title-5"> 12/5 * 17/5 </span>
                                            </div>
                                            <div class="col-xs col col-sm col-md col-lg col-xl-4 After-cutting">
                                                <span class="text-black title-5">  12 * 16/5 </span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs col col-sm col-md col-lg-4 col-xl-3 send-file-bottom-left">
                            <div class="col-xs col col-sm col-md col-lg col-xl-12 send-file-bottom-left-bottom">

                                <div>
                                    <div class="progress" style="margin-bottom: 11px">
                                        <div class="progress-bar BAR11" role="progressbar" :style="'width:'+ percent + '%'" :aria-valuenow="percent" aria-valuemin="0" aria-valuemax="100">{{percent}}%</div>
                                    </div>

                                    <div class="form-group col-xs col-8 col-sm col-md col-lg col-xl-9 flex number-page-text">
                                        <label for="inputname45" class="text-purple-input">عنوان کتاب</label>
                                        <input type="text" placeholder="کتاب" v-model="title" id="inputname45" class="form-control color-border p-input" style="min-width: -webkit-fill-available;">
                                    </div>
                                    <div class="send-file-page">
                                        <div class="custom-file">
                                            <input type="file"  class="custom-file-input" ref="pages" id="customFile2" v-on:change="handleFiles('pages')">
                                            <label class="custom-file-label" for="customFile2" style="margin-right: 15px;text-align: right;padding-right: 60px;overflow: hidden">
                                                {{pages.name}} 
                                                <!-- <i class="fas fa-upload"></i>-->
                                            </label>
                                        </div>
                                    </div>

                                    <div class="send-file-jeld">
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="customFile1" ref="cover" v-on:change="handleFiles('cover')">
                                            <label class="custom-file-label" for="customFile1" style="margin-right: 15px;text-align: right;padding-right: 60px;overflow: hidden">  {{cover.name}}  
                                           <!-- <i class="fas fa-upload"></i>-->
                                            </label>
                                        </div>
                                    </div>


                                    <div class="send-file-page">
                                        <div class="custom-file">
                                            <input type="file"  class="custom-file-input" id="customFile" ref="license" v-on:change="handleFiles('license')">
                                            <label class="custom-file-label"  for="customFile" style="margin-right: 15px;text-align: right;padding-right: 60px;overflow: hidden">  {{license.name}}
                                              <!--<i class="fas fa-upload"></i>-->
                                              </label>
                                        </div>
                                    </div>

                                    <div  v-if="ok" class="col-xs col-10 col-sm col-md col-lg col-xl-8 send-info-register">
                                        <input type="button" value="ارسال" @click="upload" class="btn" style="margin-left: 10px">
                                    </div>
                                    <div v-if="loader === 1" class="col-xs col-12 col-sm col-md col-lg col-xl-12  lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                                    <div v-for="error in errors.data" class="alert alert-danger send-file-page" v-if="ok1 === 0" role="alert" style="font-family: irs;margin-top: 12px;height: auto;float: right">
                                        {{error}}
                                    </div>

                                    <div class="alert alert-success send-file-page" v-if="ok1 === 1" role="alert" style="margin-top: 12px;height: auto;float: right">
                                        فایل ها با موفقیت ارسال شد لطفا دکمه ادامه را بزنید
                                    </div>
                                </div>
                            </div>
                            <div class="send-file-bottom-left-top">
                                <div class="col-xs col col-sm col-md col-lg col-xl-12 all-Gender-right">
                                    <form style="margin-left:px;">
                                        <label class="custom-control custom-checkbox ga-accommodation-Hotel">
                                            <input class="custom-control-input accommodation_itm" value="Hotel" type="checkbox" v-model="ok">
                                            <span class="custom-control-indicator3"></span>
                                            <span class="custom-control-description text-purple-input" style="position: absolute;right: 35px;t;line-height: ;text-align: justify;">نکات مهم چاپ را مطالعه نمودم و مسائل مربوط به عدم رعایت آنها را می پذیرم.</span>
                                        </label>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="res === 1" class="col-xs col col-sm col-md col-lg col-xl-12 send-input" style="display: flex;align-items: center;justify-content: flex-end;height: 45px;">
                <div class="col-xs col-4 col-sm-3 col-md-2 col-lg-1 col-xl-1 send-input-inside" style="height: 45px;background-color:#7c1065;;border-radius: 5px;display: flex;align-items: center;justify-content: flex-end;margin-top: 68px;margin-left: 55px;">
                    <a href="#step4" data-toggle="tab" aria-controls="step4" role="tab" title="" style="width: 146px;color: #fff;text-align: center;">
                        ادامه
                    </a>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    export default {
        mounted() {
            console.log('file mounted.')
        } ,
        data() {
            return {
                percent: 0 ,
                loader: '' ,
                ok: false ,
                errors: [] ,
                ok1: '' ,
                res: '' ,
                pages: {
                    name: 'فایل صفحات'
                } ,
                cover: {
                    name: 'فایل جلد'
                } ,
                license: {
                    name: 'فایل مجوز'
                } ,
                title: ''
            }
        } ,
        methods:{
            handleFiles(field) {
                if (field === 'pages')
                {
                    this.pages = this.$refs.pages.files[0];
                }
                if (field === 'cover')
                {
                    this.cover = this.$refs.cover.files[0];
                }
                if (field === 'license')
                {
                    this.license = this.$refs.license.files[0];
                }
            } ,
            upload() {
                this.percent = 0;
                if (localStorage.getItem('final') !== null)
                {
                    let obj = JSON.parse(localStorage.final);
                    if (obj.final_price === '' || !obj)
                    {
                        this.$swal('شما سفارشی ثبت نکرده اید' , '' , 'error');
                        window.location = '/';
                    }
                }
                else
                {
                    this.$swal('شما سفارشی ثبت نکرده اید' , '' , 'error');
                    window.location = '/';
                }
                let data = new FormData();

                if (this.license === null || this.license === '' || this.license.name === 'فایل مجوز')
                {
                    data.append('cover' , this.cover);
                    data.append('pages' , this.pages);
                    data.append('title' , this.title);
                }
                else
                {
                    data.append('cover' , this.cover);
                    data.append('pages' , this.pages);
                    data.append('license' , this.license);
                    data.append('title' , this.title);
                }

                this.loader = 1;
                this.ok1 = '';
                axios({
                    method: 'post' ,
                    url: '/api/upload/files' ,
                    data: data ,
                    headers: {
                        accept: 'application/json' ,
                        Authorization: `Bearer ${localStorage.token}`
                    } ,
                    onUploadProgress: uploadEvent => {
                        this.percent = Math.round(uploadEvent.loaded / uploadEvent.total * 100);
                    }
                })
                    .then(res => {
                        console.log(res.data);
                        localStorage.setItem('title' , this.title);
                        this.$swal('آپلود کامل شد' , 'آپلود فایل ها با موفقیت انجام شد' , 'success');
                        this.res= 1;
                        this.loader = 0;
                    })
                    .catch(err => {
                        console.log(err.response);
                        if (err.response.status === 400 || err.response.status === 401 || err.response.status === 404)
                        {
                            this.ok1 = 0;
                            this.errors = err.response;
                            this.res= 0;
                            this.loader = 0;
                        }
                        else
                        {
                            this.ok1 = 0;
                            this.errors = 'error';
                            this.res= 0;
                            this.loader = 0;
                        }
                    })
            } ,
        }
    }
</script>

<style scoped>

    .BAR11 {
        margin-bottom: -3px;
    }
    .lds-roller {
        display: inline-block;
        position: relative;
        width: 40px;
        height: 40px;
    }
    .lds-roller div {
        animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        transform-origin: 40px 40px;
    }
    .lds-roller div:after {
        content: " ";
        display: block;
        position: absolute;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: #6a2260;
        margin: -4px 0 0 -4px;
    }
    .lds-roller div:nth-child(1) {
        animation-delay: -0.036s;
    }
    .lds-roller div:nth-child(1):after {
        top: 63px;
        left: 63px;
    }
    .lds-roller div:nth-child(2) {
        animation-delay: -0.072s;
    }
    .lds-roller div:nth-child(2):after {
        top: 68px;
        left: 56px;
    }
    .lds-roller div:nth-child(3) {
        animation-delay: -0.108s;
    }
    .lds-roller div:nth-child(3):after {
        top: 71px;
        left: 48px;
    }
    .lds-roller div:nth-child(4) {
        animation-delay: -0.144s;
    }
    .lds-roller div:nth-child(4):after {
        top: 72px;
        left: 40px;
    }
    .lds-roller div:nth-child(5) {
        animation-delay: -0.18s;
    }
    .lds-roller div:nth-child(5):after {
        top: 71px;
        left: 32px;
    }
    .lds-roller div:nth-child(6) {
        animation-delay: -0.216s;
    }
    .lds-roller div:nth-child(6):after {
        top: 68px;
        left: 24px;
    }
    .lds-roller div:nth-child(7) {
        animation-delay: -0.252s;
    }
    .lds-roller div:nth-child(7):after {
        top: 63px;
        left: 17px;
    }
    .lds-roller div:nth-child(8) {
        animation-delay: -0.288s;
    }
    .lds-roller div:nth-child(8):after {
        top: 56px;
        left: 12px;
    }
    @keyframes lds-roller {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

</style>
